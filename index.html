<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Expenses & Income Tracker</title>
  <!-- iOS/PWA meta -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Ex-In Tracker">
  <link rel="apple-touch-icon" href="icons/icon-180.png">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#3b82f6">
  <style>
  /* --- styles kept from original (trimmed for brevity in this sample) --- */
  :root{--primary:#3b82f6;--primary-dark:#2563eb;--primary-light:#dbeafe;--secondary:#10b981;--secondary-dark:#059669;--danger:#ef4444;--danger-dark:#dc2626;--success:#10b981;--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#d1d5db;--gray-400:#9ca3af;--gray-500:#6b7280;--gray-600:#4b5563;--gray-700:#374151;--gray-800:#1f2937;--gray-900:#111827;--white:#ffffff}
  *{box-sizing:border-box}body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background:linear-gradient(135deg,var(--gray-50) 0%,var(--primary-light) 100%);margin:0;padding:20px;color:var(--gray-800);line-height:1.6;min-height:100vh}
  h1{margin:0 0 24px;font-size:2.2rem;font-weight:700;color:var(--gray-900);text-align:center}
  .container{max-width:1200px;margin:0 auto}
  .card{background:var(--white);border-radius:16px;padding:24px;margin-bottom:24px;border:1px solid var(--gray-200)}
  .row{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:16px}.col{flex:1;min-width:240px}
  label{display:block;font-size:14px;font-weight:500;margin-bottom:6px;color:var(--gray-700)}
  input,select,button{width:100%;padding:12px 16px;border-radius:12px;border:2px solid var(--gray-200);font-size:14px;background:var(--white)}
  button{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:#fff;border:none;cursor:pointer;font-weight:600}
  table{width:100%;border-collapse:collapse;text-align:center;white-space:nowrap;font-size:14px}
  th,td{padding:12px 16px;border:1px solid var(--gray-200)}
  th{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:#fff;position:sticky;top:0;font-weight:600;font-size:12px}
  .table-wrap{max-height:350px;overflow:auto;border-radius:12px;border:2px solid var(--gray-200);background:var(--white)}
  .total-amount{text-align:right;margin-top:16px;font-weight:700;font-size:18px;color:var(--primary)}
  .login-section{background:linear-gradient(135deg,var(--gray-50) 0%,var(--primary-light) 100%);padding:20px;border-radius:12px;border:2px solid var(--gray-200)}
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸ’° Expenses & Income Tracker</h1>

  <div class="card" id="addCard">
    <h2>â• Add Expense / Income</h2>
    <form id="addForm">
      <div class="row">
        <div class="col">
          <label>Type</label>
          <select id="entryType" required>
            <option value="" selected>-- Select Type --</option>
            <option value="expense">ğŸ’¸ Expense</option>
            <option value="income">ğŸ’µ Income</option>
          </select>
        </div>
        <div class="col">
          <label>Date</label>
          <input type="date" id="entryDate" required>
        </div>
        <div class="col">
          <label>Amount (â‚±)</label>
          <input type="number" id="entryAmount" step="0.01" min="0" required placeholder="0.00">
        </div>
      </div>
      <label>Description</label>
      <input type="text" id="entryDesc" placeholder="e.g. Groceries, Salary, Transportation" required>
      <div style="margin-top:16px;display:flex;gap:12px">
        <button type="submit">ğŸ’¾ Add Entry</button>
      </div>
      <div class="muted" style="margin-top:12px">ğŸ“± Data automatically saves in your browser (localStorage). Works offline as a PWA on iPhone after Add to Home Screen.</div>
    </form>
  </div>

  <div class="card">
    <h2>ğŸ”´ Latest Expense</h2>
    <div id="latestExpense" class="muted">No expense added yet.</div>
  </div>

  <div class="card">
    <h2>ğŸŸ¢ Latest Income</h2>
    <div id="latestIncome" class="muted">No income added yet.</div>
  </div>

  <div class="card">
    <h2>ğŸ“Š Expenses Summary</h2>
    <div id="expensesLogin" class="login-section">
      <div class="row">
        <div class="col">
          <label>ğŸ‘¤ Username</label>
          <input id="expUsername" type="text" placeholder="admin">
        </div>
        <div class="col">
          <label>ğŸ”’ Password</label>
          <input id="expPassword" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
        <div style="flex-basis:180px">
          <label> </label>
          <button type="button" onclick="loginSection('expenses')">ğŸš€ Login</button>
        </div>
      </div>
      <div id="expLoginMsg" class="error"></div>
    </div>
    <div id="expensesContent" style="display:none">
      <div class="table-wrap" style="margin-top:12px">
        <table id="expensesTable">
          <thead><tr><th>ğŸ“… Date</th><th>ğŸ“ Description</th><th>ğŸ’° Amount</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="total-amount">Total: â‚±<span id="expensesTotal">0.00</span></div>
    </div>
  </div>

  <div class="card">
    <h2>ğŸ“ˆ Income Summary</h2>
    <div id="incomeLogin" class="login-section">
      <div class="row">
        <div class="col">
          <label>ğŸ‘¤ Username</label>
          <input id="incUsername" type="text" placeholder="admin">
        </div>
        <div class="col">
          <label>ğŸ”’ Password</label>
          <input id="incPassword" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
        <div style="flex-basis:180px">
          <label> </label>
          <button type="button" onclick="loginSection('income')">ğŸš€ Login</button>
        </div>
      </div>
      <div id="incLoginMsg" class="error"></div>
    </div>
    <div id="incomeContent" style="display:none">
      <div class="table-wrap" style="margin-top:12px">
        <table id="incomeTable">
          <thead><tr><th>ğŸ“… Date</th><th>ğŸ“ Description</th><th>ğŸ’° Amount</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="total-amount">Total: â‚±<span id="incomeTotal">0.00</span></div>
    </div>
  </div>
</div>

<script>
// Keys
const EXP_KEY="tracker_expenses_v2", INC_KEY="tracker_incomes_v2", PASS_KEY_EXP="tracker_exp_pass_v2", PASS_KEY_INC="tracker_inc_pass_v2";
let expenses=JSON.parse(localStorage.getItem(EXP_KEY)||"[]"), incomes=JSON.parse(localStorage.getItem(INC_KEY)||"[]");
let credExp=JSON.parse(localStorage.getItem(PASS_KEY_EXP)||JSON.stringify({user:"admin",pass:"2121"}));
let credInc=JSON.parse(localStorage.getItem(PASS_KEY_INC)||JSON.stringify({user:"admin",pass:"2121"}));

// iOS date default today
(function(){const d=document.getElementById('entryDate'); if(d){ d.value=new Date().toISOString().split('T')[0]; }})();

function saveAll(){
  localStorage.setItem(EXP_KEY,JSON.stringify(expenses));
  localStorage.setItem(INC_KEY,JSON.stringify(incomes));
  localStorage.setItem(PASS_KEY_EXP,JSON.stringify(credExp));
  localStorage.setItem(PASS_KEY_INC,JSON.stringify(credInc));
}

function renderLatest(){
  const expEl=document.getElementById("latestExpense");
  const incEl=document.getElementById("latestIncome");
  if(expenses.length){const last=expenses[expenses.length-1]; expEl.innerHTML=`<strong>${last.date}</strong> â€¢ ${last.desc} â€¢ <strong style="color:#ef4444">â‚±${Number(last.amount).toFixed(2)}</strong>`;} else expEl.textContent="No expense added yet.";
  if(incomes.length){const last=incomes[incomes.length-1]; incEl.innerHTML=`<strong>${last.date}</strong> â€¢ ${last.desc} â€¢ <strong style="color:#10b981">â‚±${Number(last.amount).toFixed(2)}</strong>`;} else incEl.textContent="No income added yet.";
}

// Add entry
const form=document.getElementById('addForm');
form.addEventListener('submit', (e)=>{
  e.preventDefault();
  const type=document.getElementById('entryType').value;
  const date=document.getElementById('entryDate').value;
  const amount=parseFloat(document.getElementById('entryAmount').value);
  const desc=document.getElementById('entryDesc').value.trim();
  if(!type){alert('Select a type first.');return}
  if(!date||!desc||isNaN(amount)){alert('Fill valid fields.');return}
  if(type==='expense') expenses.push({date,desc,amount}); else incomes.push({date,desc,amount});
  saveAll(); renderLatest();
  if(document.getElementById('expensesContent').style.display!=="none") renderTable('expenses');
  if(document.getElementById('incomeContent').style.display!=="none") renderTable('income');
  e.target.reset(); document.getElementById('entryType').value=""; document.getElementById('entryDate').value=new Date().toISOString().split('T')[0];
});

function loginSection(section){
  if(section==='expenses'){
    const u=document.getElementById('expUsername').value.trim();
    const p=document.getElementById('expPassword').value;
    if(u===credExp.user && p===credExp.pass){
      document.getElementById('expensesLogin').style.display='none';
      document.getElementById('expensesContent').style.display='block';
      renderTable('expenses');
    } else document.getElementById('expLoginMsg').textContent='âŒ Wrong credentials';
  } else {
    const u=document.getElementById('incUsername').value.trim();
    const p=document.getElementById('incPassword').value;
    if(u===credInc.user && p===credInc.pass){
      document.getElementById('incomeLogin').style.display='none';
      document.getElementById('incomeContent').style.display='block';
      renderTable('income');
    } else document.getElementById('incLoginMsg').textContent='âŒ Wrong credentials';
  }
}

function renderTable(section){
  const tableBody=document.querySelector(`#${section}Table tbody`);
  tableBody.innerHTML='';
  const list=section==='expenses'?expenses:incomes;
  let total=0;
  list.forEach(it=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td><strong>${it.date}</strong></td><td>${escapeHtml(it.desc)}</td><td><strong>â‚±${Number(it.amount).toFixed(2)}</strong></td>`;
    tableBody.appendChild(tr); total+=Number(it.amount);
  });
  if(section==='expenses') document.getElementById('expensesTotal').textContent=Number(total).toFixed(2);
  else document.getElementById('incomeTotal').textContent=Number(total).toFixed(2);
}

function escapeHtml(s){return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));}

renderLatest();

// Register service worker
if('serviceWorker' in navigator){
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  });
}
</script>
</body>
</html>
